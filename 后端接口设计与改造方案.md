# 后端接口设计与改造方案

## 1. 项目分析

### 1.1 现有功能模块

| 模块 | 功能描述 | 当前实现方式 |
|------|----------|--------------|
| 博客文章 | 文章的增删改查、分类、标签、浏览量、点赞 | 本地模拟数据 |
| 分类管理 | 分类的增删改查、文章计数 | 本地模拟数据 |
| 工具管理 | 工具的增删改查、分类 | 本地模拟数据 |
| AI聊天 | 与AI进行智能对话 | 调用OpenAI API |

### 1.2 技术栈

| 技术 | 版本 |
|------|------|
| Vue | 3 |
| TypeScript | - |
| Pinia | - |
| Vue Router | - |
| Tauri | - |

## 2. 后端接口设计

### 2.1 接口设计原则

1. **RESTful API设计风格**
2. **统一的响应格式**
3. **完善的错误处理机制**
4. **合理的认证授权**
5. **支持分页和过滤**
6. **支持文件上传**

### 2.2 基础响应格式

```json
{
  "code": 200,
  "message": "成功",
  "data": null,
  "timestamp": 1620000000000
}
```

### 2.3 错误码定义

| 错误码 | 描述 |
|--------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 禁止访问 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |
| 501 | 功能未实现 |

### 2.4 接口详细设计

#### 2.4.1 用户认证接口

| 接口名称 | 请求方法 | URL | 请求参数 | 响应数据 | 描述 |
|----------|----------|-----|----------|----------|------|
| 用户登录 | POST | /api/auth/login | `{ username: string, password: string }` | `{ token: string, user: User }` | 用户登录 |
| 用户注册 | POST | /api/auth/register | `{ username: string, password: string, email: string }` | `{ token: string, user: User }` | 用户注册 |
| 获取当前用户 | GET | /api/auth/me | - | `{ user: User }` | 获取当前登录用户信息 |
| 用户登出 | POST | /api/auth/logout | - | `{}` | 用户登出 |
| 刷新令牌 | POST | /api/auth/refresh | `{ refreshToken: string }` | `{ token: string }` | 刷新访问令牌 |

#### 2.4.2 博客文章接口

| 接口名称 | 请求方法 | URL | 请求参数 | 响应数据 | 描述 |
|----------|----------|-----|----------|----------|------|
| 获取文章列表 | GET | /api/blogs | `{ page: number, size: number, categoryId?: string, tag?: string, keyword?: string, status?: 'draft' | 'published' }` | `{ total: number, list: BlogPost[] }` | 获取文章列表，支持分页、分类、标签和关键词过滤 |
| 获取文章详情 | GET | /api/blogs/:id | - | `{ post: BlogPost }` | 获取单篇文章详情 |
| 创建文章 | POST | /api/blogs | `BlogPostCreate` | `{ post: BlogPost }` | 创建新文章 |
| 更新文章 | PUT | /api/blogs/:id | `BlogPostUpdate` | `{ post: BlogPost }` | 更新文章 |
| 删除文章 | DELETE | /api/blogs/:id | - | `{}` | 删除文章 |
| 增加浏览量 | POST | /api/blogs/:id/views | - | `{ views: number }` | 增加文章浏览量 |
| 点赞文章 | POST | /api/blogs/:id/like | - | `{ likes: number }` | 点赞文章 |
| 获取热门文章 | GET | /api/blogs/hot | `{ limit: number }` | `{ list: BlogPost[] }` | 获取热门文章 |
| 获取最新文章 | GET | /api/blogs/recent | `{ limit: number }` | `{ list: BlogPost[] }` | 获取最新文章 |
| 获取所有标签 | GET | /api/blogs/tags | - | `{ tags: string[] }` | 获取所有标签 |

#### 2.4.3 分类接口

| 接口名称 | 请求方法 | URL | 请求参数 | 响应数据 | 描述 |
|----------|----------|-----|----------|----------|------|
| 获取分类列表 | GET | /api/categories | - | `{ list: Category[] }` | 获取所有分类 |
| 获取分类详情 | GET | /api/categories/:id | - | `{ category: Category }` | 获取单个分类详情 |
| 创建分类 | POST | /api/categories | `CategoryCreate` | `{ category: Category }` | 创建新分类 |
| 更新分类 | PUT | /api/categories/:id | `CategoryUpdate` | `{ category: Category }` | 更新分类 |
| 删除分类 | DELETE | /api/categories/:id | - | `{}` | 删除分类 |

#### 2.4.4 工具接口

| 接口名称 | 请求方法 | URL | 请求参数 | 响应数据 | 描述 |
|----------|----------|-----|----------|----------|------|
| 获取工具列表 | GET | /api/tools | `{ keyword?: string, category?: string }` | `{ list: Tool[] }` | 获取工具列表，支持搜索和分类过滤 |
| 获取工具详情 | GET | /api/tools/:id | - | `{ tool: Tool }` | 获取单个工具详情 |
| 创建工具 | POST | /api/tools | `ToolCreate` | `{ tool: Tool }` | 创建新工具 |
| 更新工具 | PUT | /api/tools/:id | `ToolUpdate` | `{ tool: Tool }` | 更新工具 |
| 删除工具 | DELETE | /api/tools/:id | - | `{}` | 删除工具 |
| 获取工具分类 | GET | /api/tools/categories | - | `{ categories: string[] }` | 获取所有工具分类 |

#### 2.4.5 文件上传接口

| 接口名称 | 请求方法 | URL | 请求参数 | 响应数据 | 描述 |
|----------|----------|-----|----------|----------|------|
| 上传文件 | POST | /api/upload | `file: File` | `{ url: string, filename: string }` | 上传文件，返回文件URL和文件名 |
| 上传图片 | POST | /api/upload/image | `file: File` | `{ url: string, filename: string }` | 上传图片，返回图片URL和文件名 |

## 3. 数据模型设计

### 3.1 用户模型 (User)

```typescript
interface User {
  id: string;
  username: string;
  email: string;
  avatar?: string;
  role: 'admin' | 'user';
  createdAt: string;
  updatedAt: string;
}
```

### 3.2 博客文章模型 (BlogPost)

```typescript
interface BlogPost {
  id: string;
  title: string;
  content: string;
  excerpt: string;
  categoryId: string;
  categoryName: string;
  author: string;
  coverImage?: string;
  views: number;
  likes: number;
  createdAt: string;
  updatedAt: string;
  tags: string[];
  status: 'draft' | 'published';
}
```

### 3.3 分类模型 (Category)

```typescript
interface Category {
  id: string;
  name: string;
  description: string;
  icon: string;
  color: string;
  postCount: number;
  createdAt: string;
}
```

### 3.4 工具模型 (Tool)

```typescript
interface Tool {
  id: string;
  name: string;
  description: string;
  category: string;
  icon: string;
  url?: string;
}
```

## 4. 前端改造方案

### 4.1 API服务层设计

创建统一的API服务层，处理所有后端接口调用，包括：
- 请求拦截器：添加认证令牌、统一请求格式
- 响应拦截器：统一处理响应、错误处理
- 封装常用请求方法：get、post、put、delete、upload

### 4.2 状态管理改造

#### 4.2.1 博客文章状态管理改造

1. **移除本地模拟数据**
2. **添加加载状态**
3. **添加错误状态**
4. **实现异步数据获取**
5. **添加数据缓存机制**

#### 4.2.2 分类状态管理改造

1. **移除本地模拟数据**
2. **添加加载状态**
3. **添加错误状态**
4. **实现异步数据获取**

#### 4.2.3 工具状态管理改造

1. **移除本地模拟数据**
2. **添加加载状态**
3. **添加错误状态**
4. **实现异步数据获取**

### 4.3 组件改造

#### 4.3.1 博客文章相关组件

1. **BlogListView.vue**
   - 改造为从API获取文章列表
   - 添加加载状态显示
   - 添加分页功能
   - 添加搜索和过滤功能

2. **BlogPostDetail.vue**
   - 改造为从API获取文章详情
   - 改造浏览量统计为API调用
   - 改造点赞功能为API调用

3. **DashboardView.vue**
   - 改造文章管理功能，使用API进行增删改查
   - 添加表单验证
   - 添加图片上传功能

#### 4.3.2 分类相关组件

1. **CategoryListView.vue**
   - 改造为从API获取分类列表
   - 改造分类管理功能，使用API进行增删改查

#### 4.3.3 工具相关组件

1. **ToolsView.vue**
   - 改造为从API获取工具列表
   - 改造工具管理功能，使用API进行增删改查

### 4.4 错误处理机制

1. **全局错误处理**：在API服务层添加全局错误处理
2. **组件级错误处理**：在各组件中添加错误捕获和显示
3. **友好的错误提示**：使用Message组件显示错误信息
4. **重试机制**：对可重试的请求添加重试功能

### 4.5 加载状态管理

1. **全局加载状态**：使用LoadingBar组件显示全局加载状态
2. **组件级加载状态**：在各组件中添加加载指示器
3. **骨架屏**：在数据加载过程中显示骨架屏

## 5. 实现步骤

### 5.1 第一步：创建API服务层

1. 创建`src/services/api.ts`文件，封装axios实例
2. 添加请求和响应拦截器
3. 封装常用请求方法

### 5.2 第二步：创建各模块API服务

1. 创建`src/services/blogApi.ts`：处理博客文章相关API调用
2. 创建`src/services/categoryApi.ts`：处理分类相关API调用
3. 创建`src/services/toolApi.ts`：处理工具相关API调用
4. 创建`src/services/authApi.ts`：处理用户认证相关API调用
5. 创建`src/services/uploadApi.ts`：处理文件上传相关API调用

### 5.3 第三步：改造状态管理

1. 改造`src/stores/blogStore.ts`：移除本地模拟数据，使用API调用
2. 改造`src/stores/categoryStore.ts`：移除本地模拟数据，使用API调用
3. 改造`src/stores/toolStore.ts`：移除本地模拟数据，使用API调用
4. 添加用户认证状态管理：创建`src/stores/authStore.ts`

### 5.4 第四步：改造组件

1. 按模块依次改造各组件，替换本地数据为API调用
2. 添加加载状态和错误处理
3. 完善表单验证和用户交互

### 5.5 第五步：测试和优化

1. 测试所有API调用
2. 优化加载状态和错误处理
3. 优化用户体验
4. 进行性能测试和优化

## 6. 预期效果

1. **数据持久化**：所有数据存储在后端，保证数据安全和一致性
2. **多端同步**：支持多设备登录和数据同步
3. **更好的用户体验**：添加加载状态和错误处理，提升用户体验
4. **可扩展性**：后端接口设计支持后续功能扩展
5. **安全性**：添加用户认证和授权，保证系统安全

## 7. 注意事项

1. **跨域处理**：后端需要配置CORS，允许前端域名访问
2. **认证机制**：使用JWT认证，注意令牌的过期和刷新
3. **错误处理**：前后端需要统一错误码和错误信息格式
4. **性能优化**：合理使用缓存，减少不必要的API调用
5. **安全性**：注意防止SQL注入、XSS攻击等安全问题
6. **文件上传**：注意文件大小限制和类型验证

## 8. 后续扩展

1. **添加评论功能**：支持文章评论和回复
2. **添加收藏功能**：支持用户收藏文章
3. **添加统计功能**：文章阅读量、点赞量统计
4. **添加通知功能**：系统通知和消息推送
5. **添加搜索功能**：支持全文搜索
6. **添加API文档**：使用Swagger或Postman生成API文档

---

以上是为纯前端项目设计的完整后端接口体系和改造方案。该方案涵盖了用户认证、数据获取、数据提交、文件上传等核心功能，并针对项目中原本使用模拟数据或本地存储的功能模块制定了详细的改造方案，确保前后端数据交互的顺畅与稳定。